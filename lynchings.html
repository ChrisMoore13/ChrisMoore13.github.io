<head>
	<title>Incidents of Lynching in NC</title>
	<link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700%7CDroid+Sans:400,700%7CArvo:400,700" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="./main.min.css">
	<link rel="Shortcut Icon" href="http://wwwcache.wral.com/favicon.ico" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<style>
	   pre, code {
            padding: 5px;
            background-color: #e9e9e9;
        }
        .nc_county {
            stroke: #fff;
            stroke-width:0.7;
        }
        .nc_county:hover {
            stroke:#a6a8ab;
            stroke-width:1;
        }
        .selected {
            stroke:#a6a8ab;
            stroke-width:1;
        }
        #svg {
            width:100%;
            max-height: 100%;
        }
        svg {
            position: absolute;
            top: 0;
            left: 0;
        }
        .map_container {
            height: 0;
            padding-top: 38%;
            position: relative;
        }
        .maplegend {
            border:0;
            padding:0;
            text-align: center;
            font-size:12px;
            float:right;
            width:40px;
            height:15px;
            border-top:1px solid #a6a8ab;
            border-bottom:1px solid #a6a8ab;
        }
        .maplegend-a {
            border:0;
            padding:0;
            text-align: center;
            font-size:12px;
            float:right;
            width:40px;
            height:15px;
            border-top:1px solid #a6a8ab;
            border-left:1px solid #a6a8ab;
            border-bottom:1px solid #a6a8ab;
        }
        hr {
            margin-bottom:6px;
        }
        .attr{
            text-align: right;
            font-style: italic;
            font-size: 11px;
            color: rgb(171, 171, 171);
            margin:0;
            padding:0px;
            clear:both;
        }
        .top-var{
            font-weight:300;
            margin-top:10px;
            line-height: 120%;
            color:#b7b7b7;
        }
	</style>
</head>
<body class="wral">
	<div class="g-wrap">
		<div class="container">
			<div class="1-default">
				<h2 style="margin-top:20px;">Incidents of Lynching in NC from 1865 to 1941</h2>
                    <div style="clear:both;">
                        <hr />
                        <h4>Data by county</h4>
                        <p>Select a county below to find out the number of lynchings that occurred between 1865 and 1941.</p>
                        <select style="margin-top:10px;" id="county_select">
                            <option value="ALAMANCE">ALAMANCE</option>
                            <option value="ALEXANDER">ALEXANDER</option>
                            <option value="ALLEGHANY">ALLEGHANY</option>
                            <option value="ANSON">ANSON</option>
                            <option value="ASHE">ASHE</option>
                            <option value="AVERY">AVERY</option>
                            <option value="BEAUFORT">BEAUFORT</option>
                            <option value="BERTIE">BERTIE</option>
                            <option value="BLADEN">BLADEN</option>
                            <option value="BRUNSWICK">BRUNSWICK</option>
                            <option value="BUNCOMBE">BUNCOMBE</option>
                            <option value="BURKE">BURKE</option>
                            <option value="CABARRUS">CABARRUS</option>
                            <option value="CALDWELL">CALDWELL</option>
                            <option value="CAMDEN">CAMDEN</option>
                            <option value="CARTERET">CARTERET</option>
                            <option value="CASWELL">CASWELL</option>
                            <option value="CATAWBA">CATAWBA</option>
                            <option value="CHATHAM">CHATHAM</option>
                            <option value="CHEROKEE">CHEROKEE</option>
                            <option value="CHOWAN">CHOWAN</option>
                            <option value="CLAY">CLAY</option>
                            <option value="CLEVELAND">CLEVELAND</option>
                            <option value="COLUMBUS">COLUMBUS</option>
                            <option value="CRAVEN">CRAVEN</option>
                            <option value="CUMBERLAND">CUMBERLAND</option>
                            <option value="CURRITUCK">CURRITUCK</option>
                            <option value="DARE">DARE</option>
                            <option value="DAVIDSON">DAVIDSON</option>
                            <option value="DAVIE">DAVIE</option>
                            <option value="DUPLIN">DUPLIN</option>
                            <option value="DURHAM">DURHAM</option>
                            <option value="EDGECOMBE">EDGECOMBE</option>
                            <option value="FORSYTH">FORSYTH</option>
                            <option value="FRANKLIN">FRANKLIN</option>
                            <option value="GASTON">GASTON</option>
                            <option value="GATES">GATES</option>
                            <option value="GRAHAM">GRAHAM</option>
                            <option value="GRANVILLE">GRANVILLE</option>
                            <option value="GREENE">GREENE</option>
                            <option value="GUILFORD">GUILFORD</option>
                            <option value="HALIFAX">HALIFAX</option>
                            <option value="HARNETT">HARNETT</option>
                            <option value="HAYWOOD">HAYWOOD</option>
                            <option value="HENDERSON">HENDERSON</option>
                            <option value="HERTFORD">HERTFORD</option>
                            <option value="HOKE">HOKE</option>
                            <option value="HYDE">HYDE</option>
                            <option value="IREDELL">IREDELL</option>
                            <option value="JACKSON">JACKSON</option>
                            <option value="JOHNSTON">JOHNSTON</option>
                            <option value="JONES">JONES</option>
                            <option value="LEE">LEE</option>
                            <option value="LENOIR">LENOIR</option>
                            <option value="LINCOLN">LINCOLN</option>
                            <option value="MACON">MACON</option>
                            <option value="MADISON">MADISON</option>
                            <option value="MARTIN">MARTIN</option>
                            <option value="MCDOWELL">MCDOWELL</option>
                            <option value="MECKLENBURG">MECKLENBURG</option>
                            <option value="MITCHELL">MITCHELL</option>
                            <option value="MONTGOMERY">MONTGOMERY</option>
                            <option value="MOORE">MOORE</option>
                            <option value="NASH">NASH</option>
                            <option value="NEW_HANOVER">NEW HANOVER</option>
                            <option value="NORTHAMPTON">NORTHAMPTON</option>
                            <option value="ONSLOW">ONSLOW</option>
                            <option value="ORANGE">ORANGE</option>
                            <option value="PAMLICO">PAMLICO</option>
                            <option value="PASQUOTANK">PASQUOTANK</option>
                            <option value="PENDER">PENDER</option>
                            <option value="PERQUIMANS">PERQUIMANS</option>
                            <option value="PERSON">PERSON</option>
                            <option value="PITT">PITT</option>
                            <option value="POLK">POLK</option>
                            <option value="RANDOLPH">RANDOLPH</option>
                            <option value="RICHMOND">RICHMOND</option>
                            <option value="ROBESON">ROBESON</option>
                            <option value="ROCKINGHAM">ROCKINGHAM</option>
                            <option value="ROWAN">ROWAN</option>
                            <option value="RUTHERFORD">RUTHERFORD</option>
                            <option value="SAMPSON">SAMPSON</option>
                            <option value="SCOTLAND">SCOTLAND</option>
                            <option value="STANLY">STANLY</option>
                            <option value="STOKES">STOKES</option>
                            <option value="SURRY">SURRY</option>
                            <option value="SWAIN">SWAIN</option>
                            <option value="TRANSYLVANIA">TRANSYLVANIA</option>
                            <option value="TYRRELL">TYRRELL</option>
                            <option value="UNION">UNION</option>
                            <option value="VANCE">VANCE</option>
                            <option value="WAKE" selected>WAKE</option>
                            <option value="WARREN">WARREN</option>
                            <option value="WASHINGTON">WASHINGTON</option>
                            <option value="WATAUGA">WATAUGA</option>
                            <option value="WAYNE">WAYNE</option>
                            <option value="WILKES">WILKES</option>
                            <option value="WILSON">WILSON</option>
                            <option value="YADKIN">YADKIN</option>
                            <option value="YANCEY">YANCEY</option>
                        </select>

                        <!-- MAP HERE -->
                        <div class="map-loading" style="height:225px;">
                            <h3 style="text-align:center;margin-top:40px;margin-bottom:10px;text-transform:uppercase;">Loading map</h3>
                            <img src="http://wwwcache.wral.com/presentation/v3/images/widgets/wait_popup/spinner.gif" style="width:31px;margin:auto;display:block;" />
                        </div>
                        <div id="map" style="margin-bottom:0px; display:none;">
                        </div>
                        <!-- END MAP -->

                        <div style="margin:0;">
                            <div style="margin:0;padding-top:0px;display:block;">
                                <div style="float:right;padding-bottom:30px;">
                                    <div style="text-align:center;text-transform:uppercase;font-size:12px;padding:0;">Legend</div>
                                    <div>
                                        <div class="maplegend" style="background-color:#3182bd;"><br />8+</div>
                                        <div class="maplegend" style="background-color:#9ecae1;"><br />2+-8</div>
                                        <div class="maplegend" style="background-color:#deebf7;"><br />0+-2</div>
                                        <div class="maplegend-a" style="background-color:#eff3ff;"><br />0</div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 class="top-var" >Total Number of Lynchings: <span style="color:#333;"><span id="variable">6.45</span>%</span></h4>
                            </div>
                            <div class="attr">
                                Graphic by Christopher A. Moore
                            </div>
                        </div>
                        <hr>
                    </div>

				</pre>
			</div>
		</div>
	</div>

    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="https://cdn.rawgit.com/zenorocha/clipboard.js/v1.5.10/dist/clipboard.min.js"></script>
	<script>
        new Clipboard('.btn');

        $("#etag-copy").click(function(){
            var holdtext = $("#etag")[0].innerText;
            Copied = holdtext.createTextRange();
            Copied.execCommand("Copy");
        });

        var abawd_data;

        //pulling data from: 14791220
        $.get('https://chrismoore13.github.io/abawd-rate.json',function(data){
            abawd_data = data;

            //initial height and width recalculated
            var width = 600,
            height = 220;

            var projection = d3.geo.mercator()
            .scale(3850)
            .center([102.8,33.5])
            .rotate([-180,0]);

            var path = d3.geo.path().projection(projection);

            //resizing from here: http://stackoverflow.com/questions/20885164/how-to-create-a-responsive-map-using-d3
            var svg = d3.select("#map")
            .append("div")
            .attr("id","svg")
            .append("div")
            .attr("class","map_container")
            .append("svg")
            .attr("viewBox","0 0 " + width + " " + height)
            .attr("preserveAspectRatio","xMinYMin");

            d3.json("http://wraldata.github.io/data/nc-counties-optimized.json", function(error, nc) {
                svg.selectAll(".nc_county")
                .data(topojson.feature(nc, nc.objects.nc_counties).features)
                .enter().append("path")
                .attr("class", function(d) {
                    if(d.properties.NAME == "Wake"){return "nc_county " + d.properties.NAME + " selected"}
                    else{return "nc_county " + d.properties.NAME}
                })
                .attr("id", function(d) {return d.properties.NAME.toUpperCase().split(' ').join('_')})
                .attr("d", path)
                .on("click", function(d) {
                    d3.selectAll(".selected").classed("selected", false);
                    d3.select(this).classed("selected", true);
                    svg.selectAll("path").sort(function (a, b) { // select the parent and sort the path's
                        if (a != d) return -1;               // a is not the clicked element, send "a" to the back
                        else return 1;                             // a is the clicked element, bring "a" to the front
                    });
                    county = $(this).attr('id');
                    $('#county_select').val(county);
                    $('#variable').html(function(){
                        for(i=0; i<abawd_data.length; i++){
                            if(county == abawd_data[i]['county']){
                                return abawd_data[i]['abawd_rate'];
                            }
                        }
                    });
                })
                parseData();
                $('.map-loading').css('display','none');
                $('#map').css('display','block');
            });

            function parseData(){
                for (j=0; j < abawd_data.length; j++){
                    variable = parseFloat(abawd_data[j]['abawd_rate']);
                    id_name = '#'+ abawd_data[j]['county'];
                    switch (true){
                        case (variable <= 0 ):
                            $(id_name).css('fill','#eff3ff');
                            break;
                        case (variable > 0 && variable < 2.01 ):
                            $(id_name).css('fill','#deebf7');
                            break;
                        case (variable >= 2.01 && variable < 8 ):
                            $(id_name).css('fill','#9ecae1');
                            break;
                        case (variable >= 8 ):
                            $(id_name).css('fill','#3182bd');
                            break;
                        default:
                            console.log("ERROR: no color category")
                            break;
                    }
                }
            }

            //workaround for making sure path appears on top
            jQuery.fn.d3Click = function () {
                this.each(function (i, e) {
                    var evt = document.createEvent("MouseEvents");
                    evt.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
                    e.dispatchEvent(evt);
                });
            };

            $('#county_select').change(function(e){
                e.preventDefault();
                county_display = $(this).val()
                var i = 0;
                while(abawd_data[i]['county'] != county_display){
                    i++;
                }
                $('path').removeClass('selected');
                $('#'+ county_display).addClass('selected');
                document.getElementById("variable").innerHTML = abawd_data[i]['abawd_rate'];
                //Invoke d3 command for making sure path is properly shaded
                $('#'+county_display).d3Click();
            });

        });//END OF GET
        </script>
</body>
